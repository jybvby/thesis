"use strict";(self.webpackChunkSHEIN_W=self.webpackChunkSHEIN_W||[]).push([[40965],{240965:(e,t,n)=>{n.d(t,{It:()=>F,OY:()=>A,v3:()=>j});var i=n(869588),o=n(538353),r=n(665640);function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){p(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function a(e){return function(e){if(Array.isArray(e))return u(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||c(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,t){if(e){if("string"==typeof e)return u(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(e,t):void 0}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,g(i.key),i)}}function v(e,t,n){return t&&h(e.prototype,t),n&&h(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function p(e,t,n){return(t=g(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function g(e){var t=function(e,t){if("object"!=d(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=d(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==d(t)?t:t+""}var b=function(e){var t;return"undefined"==typeof window?null:{container:e.scrollContainer?e.scrollContainer instanceof HTMLElement?e.scrollContainer:document.querySelector(e.scrollContainer):window,key:[null===(t=e.mask)||void 0===t?void 0:t.map((function(e){return parseFloat(String(e))})).join(""),e.delay,e.exposeRatio,e.observeHide?"obHide":""].join("")}},y={cache:new Map,get:function(e){var t=(this.cache.get(e.container)||[]).find((function(t){return t.key==e.key}));return t?t.instance:null},set:function(e){var t=this.cache.get(e.container)||[];t.find((function(t){return t.key==e.key}))||(t.push({key:e.key,instance:e.instance}),this.cache.set(e.container,t))},del:function(e){if(e.key){var t=this.cache.get(e.container)||[],n=t.findIndex((function(t){return t.key==e.key}));t.splice(n,1),t.length?this.cache.set(e.container,t):this.cache.delete(e.container)}else this.cache.delete(e.container)}},m="da-eid",w="da-rid",k=function(e){if("undefined"==typeof window||!e)return"";if("string"==typeof e)return e;if(e instanceof HTMLElement){var t=e.getAttribute(m);return"[".concat(m,"=").concat(t,"]")}if((0,i.G)(e))return e.target instanceof HTMLElement?{code:(null==e?void 0:e.code)||"",target:k(e.target)}:e;if(e.length){var n=e[0].classList;return Array.prototype.map.call(n,(function(e){return".".concat(e)})).join("")}return""},E=function(e){return"undefined"!=typeof window&&e?e instanceof HTMLElement?[e]:"string"==typeof e?Array.prototype.slice.call(document.querySelectorAll(e)):(0,i.G)(e)?E(e.target):e.length?Array.prototype.slice.call(e):[e]:[]},O=function(){return Number(Math.random().toString().slice(3,6)+(Date.now()+Math.floor(1e3*Math.random()*100))).toString(36)},I=function(e,t){var n=void 0;switch(e){case"error":n=r.error;break;case"warn":n=r.warn;break;default:n=r.info}"undefined"!=typeof window&&n(t)},x=function(e){if(!e)return{};var t=e.getBoundingClientRect&&e.getBoundingClientRect()||{},n=t.top,i=void 0===n?0:n,o=t.bottom,r=void 0===o?0:o,s=t.right,l=void 0===s?0:s,a=t.left;return{top:i,bottom:r,right:l,left:void 0===a?0:a,height:e.offsetHeight||e.innerHeight,width:e.offsetWidth||e.innerWidth}},C=function(e,t){if(!e||!t)return!1;var n=e,o=t,r=0,s=[0,0,0,0];if((0,i.G)(e)&&(n=e.el,r=e.ratio||0),(0,i.G)(t)&&(o=t.el,t.mask&&Array.isArray(t.mask)&&t.mask.filter((function(e,t){s[t]=parseInt(String(e))}))),!n||!o)return!1;var l=x(n),a=l.top,c=void 0===a?0:a,u=l.left,d=void 0===u?0:u,f=l.right,h=void 0===f?0:f,v=l.bottom,p=void 0===v?0:v,g=l.width,b=void 0===g?0:g,y=l.height,m=void 0===y?0:y;if(0==b||0==m)return!1;var w=x(o),k=w.top,E=void 0===k?0:k,O=w.left,I=void 0===O?0:O,C=w.width,S=void 0===C?0:C,A=w.height,M=void 0===A?0:A,B=S+I-s[1],P=E+M-s[2],j=E+s[0],F=I+s[3];return!(c>=P-m*r||p<=j+m*r)&&!(h<=F+b*r||d>=B-b*r)},S=m,A=function(){return v((function e(t,n){f(this,e),p(this,"initParams",void 0),p(this,"intersectionObFn",void 0),p(this,"listenerEvent",void 0),p(this,"scrollProgress",-1),p(this,"scrollCbFn",[]),p(this,"listenAddScroll",new Map),p(this,"listenMap",new Map),p(this,"scrollContainer",void 0),"undefined"!=typeof window&&(null!=n&&n.fromExpose&&I("info","scroll event from expose❗️"),this.initParams=n,this.intersectionObFn=t,this.scrollContainer=null!=n&&n.scrollContainer?E(null==n?void 0:n.scrollContainer)[0]:window,this.init())}),[{key:"init",value:function(){var e;this.listenerEvent=this.createListener(this.handelScrollEvent).bind(this),null===(e=this.scrollContainer)||void 0===e||e.addEventListener("scroll",this.listenerEvent,!1)}},{key:"createListener",value:function(e,t){return void 0===e?function(){}:t&&t>0?(0,o.n)({func:e,wait:t,options:{trailing:!1}}):e}},{key:"handelScrollEvent",value:function(e){this.listenScroll(e),"function"==typeof this.intersectionObFn&&this.listenMap.size&&this.listenerEl()}},{key:"listenerEl",value:function(){var e,t=this,n=[];this.listenMap.forEach((function(e){var i=t._withInArea(e.target);e.isIntersecting!==i&&(t.listenMap.set(e.id,Object.assign(e,{isIntersecting:i})),n.push({isIntersecting:i,target:e.target}))})),n.length&&(null===(e=this.intersectionObFn)||void 0===e||e.call(this,n))}},{key:"_withInArea",value:function(e){var t,n;return C({el:e,ratio:(null===(t=this.initParams)||void 0===t?void 0:t.exposeRatio)||0},{el:this.scrollContainer||window,mask:(null===(n=this.initParams)||void 0===n?void 0:n.mask)||[0,0,0,0]})}},{key:"listenScroll",value:function(e){if(this.scrollCbFn.length){var t=this.scrollContainer===window?Math.abs(x(document.body).top||0):this.scrollContainer.scrollTop||0,n=t-this.scrollProgress;if(0!==n){var i={scrollTop:t,type:n>0?"down":"up"};this.scrollProgress=t,this.scrollCbFn.forEach((function(t){return t(i,e)}))}}}},{key:"listen",value:function(e,t){if("function"==typeof e){var n=O(),i=this.createListener(e,null==t?void 0:t.delay);return this.listenAddScroll.set(n,i),this.scrollCbFn.push(i),n}}},{key:"unListen",value:function(e){if(e&&this.listenAddScroll.has(e)){this.listenAddScroll.delete(e);var t=[];this.listenAddScroll.forEach((function(e){t.push(e)})),this.scrollCbFn=t}}},{key:"observe",value:function(e){if(e){var t=e.getAttribute(S);t&&this.listenMap.has(t)||(t||(t=O(),e.setAttribute(S,t)),this.listenMap.set(t,{id:t,isIntersecting:!1,target:e}))}}},{key:"unobserve",value:function(e){if(e){var t=e.getAttribute(S);t&&this.listenMap.delete(t)}}},{key:"disconnect",value:function(){var e;this.listenerEvent&&(null===(e=this.scrollContainer)||void 0===e||e.removeEventListener("scroll",this.listenerEvent,!1))}}])}(),M=function(){return v((function e(t,n){f(this,e),p(this,"evt",null),p(this,"initOption",void 0),p(this,"handleExposeEvent",[]),p(this,"scrollContainer",void 0),p(this,"io",null),this.initOption=t||null,"undefined"!=typeof window&&(this.scrollContainer=null!=t&&t.scrollContainer?E(null==t?void 0:t.scrollContainer)[0]:null,this.init(n))}),[{key:"init",value:function(e){if(this.evt=function(e,t){if("function"==typeof window.CustomEvent)return new CustomEvent(e,t);t=t||{bubbles:!1,cancelable:!1,detail:null};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n}("scroll",{bubbles:!1,cancelable:!1}),window.hasOwnProperty("IntersectionObserver")){var t,n,i=(null===(t=this.initOption)||void 0===t||null===(t=t.mask)||void 0===t?void 0:t.map((function(e){return"".concat(-(parseInt(String(e))||0),"px")})).join(" "))||"0px 0px 0px 0px";this.io=new IntersectionObserver(e,{root:this.scrollContainer||null,rootMargin:i,threshold:[(null===(n=this.initOption)||void 0===n?void 0:n.exposeRatio)||0]}),this.scrollContainer=this.scrollContainer||window}else{var o,r,s=this.scrollContainer||window;this.scrollContainer=s,this.io=new A(e,{scrollContainer:s,exposeRatio:(null===(o=this.initOption)||void 0===o?void 0:o.exposeRatio)||0,mask:null===(r=this.initOption)||void 0===r?void 0:r.mask})}}},{key:"triggerScroll",value:function(){var e=this;(0,o.n)({func:function(){var t;null===(t=e.scrollContainer)||void 0===t||t.dispatchEvent(e.evt)},wait:300,options:{trailing:!1}})}},{key:"destroy",value:function(){var e;null===(e=this.io)||void 0===e||e.disconnect()}}])}(),B=m,P=w,j=function(){return v((function e(t){f(this,e),p(this,"hasBeenExposeId",new Map),p(this,"initParams",void 0),p(this,"scrollInstance",null),p(this,"singleBlockObMap",new Map),p(this,"intersectionIoMap",new Map),p(this,"intersectionTempExpose",new Set),p(this,"timer",void 0),p(this,"logFn",(function(){})),this.initParams=t,void 0!==("undefined"==typeof window?"undefined":d(window))&&this.init(t)}),[{key:"init",value:function(e){this.scrollInstance=new M({scrollContainer:null==e?void 0:e.scrollContainer,exposeRatio:null==e?void 0:e.exposeRatio,delay:null==e?void 0:e.delay,mask:null==e?void 0:e.mask},this.intersectionObserverCallback.bind(this)),this.logFn=null!=e&&e.log?I:function(){}}},{key:"intersectionObserverCallback",value:function(e){var t=this;e.forEach((function(e){var n=e.target;if(e.isIntersecting){var i=(t.initParams||{}).delay,o=void 0===i?1e3:i;t.intersectionTempExpose.add(n),clearTimeout(t.timer),t.timer=setTimeout((function(){t.intersectionPreExpose(a(t.intersectionTempExpose)),t.intersectionTempExpose.clear()}),o)}else{var r;null!==(r=t.initParams)&&void 0!==r&&r.observeHide&&t.sendHideEvent(n)}}))}},{key:"intersectionPreExpose",value:function(e){var t=this;if(e.length){var n={};for(var i in e.forEach((function(e){if(t._withInArea(e)){var i=e.getAttribute(B),o=t.intersectionIoMap.get(i);o&&(n[o.code]||(n[o.code]={info:o,exposeDoms:[]}),n[o.code].exposeDoms.push(e))}})),n){var o=n[i];o.exposeDoms.length&&this.sendExposeEvent(o.info,o.exposeDoms)}}}},{key:"sendHideEvent",value:function(e){if(e){var t=e.getAttribute(B),n=this.intersectionIoMap.get(t);if(n){var i=n.code;(0,n.handle)({code:i,exposeDoms:[],hideDoms:[e]})}}}},{key:"sendExposeEvent",value:function(e,t){var n=this,i=e.code,o=e.once,r=e.handle,s=e.middleJudge,l=t.filter((function(e){var t=n.hasBeenExposeId.get(i)||new Set,r=e.getAttribute(B)||"",l=e.getAttribute(P)||"",a=l?t.has(l):t.has(r);if(a)o&&n.removeElements([e]);else{if("function"==typeof s&&!s(e,i))return!1;o&&(t.add(r),l&&t.add(l),n.hasBeenExposeId.set(i,t),n.removeElements([e]))}return!a}));l.length&&r({code:i,hideDoms:[],exposeDoms:l})}},{key:"_withInArea",value:function(e){var t,n,i;return C({el:e,ratio:(null===(t=this.initParams)||void 0===t?void 0:t.exposeRatio)||0},{el:null===(n=this.scrollInstance)||void 0===n?void 0:n.scrollContainer,mask:(null===(i=this.initParams)||void 0===i?void 0:i.mask)||[0,0,0,0]})}},{key:"addEleObId",value:function(e){return e.filter((function(e){if(e&&1==e.nodeType){if(!e.getAttribute(B)){var t=O();e.setAttribute(B,t)}return!0}}))}},{key:"singleBlock",value:function(e,t){var n=this,i=e.elements,o=(null==e?void 0:e.code)||(null==i?void 0:i.code)||"".concat(O(),"_code"),r={code:o,handle:t,once:void 0===e.once||e.once,middleJudge:null==e?void 0:e.middleJudge,elements:"",ids:new Set},s=this.addEleObId(E(i));if(s.length){var l=this.hasBeenExposeId.get(r.code);if(!(s=s.filter((function(e){var t=e.getAttribute(B)||"";return!(l&&l.has(t)||n.intersectionIoMap.has(t))}))).length)return this.logFn("warn","[basis-expose]: 未查询到元素，请检查元素是否[已曝光｜未创建]");r.elements=k(i),this.singleBlockObMap.has(o)||this.singleBlockObMap.set(o,Object.assign({},r));var a=s.map((function(e){return null==e?void 0:e.getAttribute(B)})).filter((function(e){return!!e})),c=this.singleBlockObMap.get(o)||{};a.forEach((function(e){c.ids.add(e)})),this.singleBlockObMap.set(o,c),this.addToIntersectionOb(s,Object.assign({},r,{ids:null}))}}},{key:"multiBlock",value:function(e,t){var n=this,i=e.section;if(!i||!i.length)return this.logFn("warn","[basis-expose]: multiBlock - 请传入正确的 section 格式");i.filter((function(e){return!!e.target})).forEach((function(i){var o=i.container,r=i.content,s=i.target,a=i.code||"".concat(O(),"_code"),c=[o,r,s].filter((function(e){return!!e})).join(" ");n.singleBlock(l(l({},e),{},{elements:{code:a,target:c}}),t)}))}},{key:"addToIntersectionOb",value:function(e,t){var n=this;e.forEach((function(e){var i,o=e.getAttribute(B);if(!n.intersectionIoMap.has(o)){var r=e.getAttribute(P);if(t.code&&r){var s=n.hasBeenExposeId.get(t.code);if(s&&s.has(r))return}n.intersectionIoMap.set(o,t),null===(i=n.scrollInstance)||void 0===i||i.io.observe(e)}}))}},{key:"removeElements",value:function(e){if(!e||!e.length)return this.logFn("warn","[basis-expose]: removeElements - 元素应该给数组类型");var t,n=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=c(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){l=!0,r=e},f:function(){try{s||null==n.return||n.return()}finally{if(l)throw r}}}}(e);try{for(n.s();!(t=n.n()).done;){var i,o,r,s,l=t.value;null===(i=this.scrollInstance)||void 0===i||i.io.unobserve(l);var a=l.getAttribute(B),u=this.intersectionIoMap.get(a),d=this.singleBlockObMap.get(u.code);null==d||null===(o=d.ids)||void 0===o||null===(r=(s=o).delete)||void 0===r||r.call(s,a),this.intersectionIoMap.delete(a)}}catch(e){n.e(e)}finally{n.f()}}},{key:"observe",value:function(e,t){var n=this;if(e){var i=e.elements,o=e.section;i||o?(i&&(Array.isArray(i)?i.forEach((function(i){n.singleBlock(l(l({},e),{},{elements:i}),t)})):this.singleBlock(e,t)),o&&o.length&&this.multiBlock(e,t),this.triggerScroll()):this.logFn("info","[basis-expose]: observe - 缺少元素|选择器")}}},{key:"update",value:function(e){var t=this;if(!e)return this.logFn("warn","[basis-expose]: update - 方法缺少code");e.split(",").forEach((function(e){var n=t.singleBlockObMap.get(e);if(n){var i=n.handle;t.singleBlock(n,i)}})),this.triggerScroll()}},{key:"remove",value:function(e){var t=this;if(!e)return this.logFn("warn","[basis-expose]: remove - 方法缺少code");e.split(",").forEach((function(e){var n=t.singleBlockObMap.get(e);if(n){var i=n.ids;(null==i?void 0:i.size)>0&&i.forEach((function(e){t.intersectionIoMap.delete(e)})),t.singleBlockObMap.delete(e)}t.hasBeenExposeId.delete(e)}))}},{key:"reset",value:function(e){var t=this;if(!e)return this.logFn("warn","[basis-expose]: reset - 方法缺少code");var n=this.hasBeenExposeId.get(e);n&&(this.hasBeenExposeId.delete(e),a(n).forEach((function(n){var i=E("[".concat(B,'="').concat(n,'"]'));if(i){var o=t.singleBlockObMap.get(e);o&&t.singleBlock(l(l({},o),{},{elements:{code:e,target:i}}),o.handle)}})),this.triggerScroll())}},{key:"resetAll",value:function(e){var t=this;if(this.hasBeenExposeId.size>0){var n,i,o=a(this.hasBeenExposeId);if(e)"function"==typeof e&&(o=e(o)),"string"==typeof e&&(o=null===(n=o)||void 0===n||null===(i=n.filter)||void 0===i?void 0:i.call(n,(function(t){return!!t.length&&t[0].startsWith(e)})));o.map((function(e){return e[0]})).forEach((function(e){t.reset(e)}))}}},{key:"destroy",value:function(){var e;null===(e=this.scrollInstance)||void 0===e||e.destroy();var t=b(this.initParams||{});t&&y.del(t)}},{key:"triggerScroll",value:function(){var e;null===(e=this.scrollInstance)||void 0===e||e.triggerScroll()}}])}(),F=function(e){var t=b(e||{});if(t){var n=y.get(t);if(n)return n}var i=new j(e);return t&&y.set(Object.assign(t,{instance:i})),i}}}]);
//# sourceMappingURL=40965-7719a44c5b5db695.js.map